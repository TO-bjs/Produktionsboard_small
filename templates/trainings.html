{% extends 'base.html' %}

{% block title %}Schulungskalender{% endblock %}

{% block content %}
<div class="container mt-5">
  <h2 class="mb-4">ðŸ“… Schulungen</h2>

  <h4>ðŸ”” In den nÃ¤chsten 30 Tagen:</h4>
    <ul class="list-group mb-4" id="upcoming-list">
    <li class="list-group-item">Lade Daten...</li>
    </ul>

  <h4 class="mt-5 mb-3">ðŸ—“ Kalenderansicht</h4>
  <div id="calendar" class="border rounded shadow-sm p-3 bg-white"></div>
</div>
{% endblock %}
{% block scripts %}
<!-- FullCalendar Core + Plugins -->

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const calendarEl = document.getElementById('calendar');

    const calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      locale: 'de',
      height: 550,
      events: '/api/trainings',
      eventClick: function(info) {
        const title = info.event.title || '';
        const participants = (info.event.extendedProps && info.event.extendedProps.participants) || '';
        let message = title;
        if (participants.trim()) {
          const list = participants.split(',').map(p => p.trim()).filter(Boolean).join('\nâ€¢ ');
          message += '\n\nTeilnehmer:\nâ€¢ ' + list;
        } else {
          message += '\n\nKeine Teilnehmer eingetragen.';
        }
        alert(message);
      }
    });

    calendar.render();

    setInterval(() => calendar.refetchEvents(), 30000);

    function reloadUpcomingList() {
      fetch('/api/trainings/upcoming')
        .then(response => response.text())
        .then(html => { document.getElementById('upcoming-list').innerHTML = html; });
    }
    reloadUpcomingList();
    setInterval(reloadUpcomingList, 30000);
  });
</script>

<script>
  // Nur umleiten, wenn "?slideshow=1" in der URL ist
  const params = new URLSearchParams(window.location.search);
  if (params.get("slideshow") === "1") {
    const nextPages = {
      "/landing": "/anzeige?slideshow=1",
      "/anzeige": "/schulungen?slideshow=1",
      "/schulungen": "/qualimatrix?slideshow=1",
      "/qualimatrix": "/landing?slideshow=1"
    };

    const path = window.location.pathname;
    const next = nextPages[path];

    if (next) {
      setTimeout(() => {
        window.location.href = next;
      }, 60000);
    }
  }
</script>


{% endblock %}

